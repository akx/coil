(this.webpackJsonpcoil=this.webpackJsonpcoil||[]).push([[0],{10:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return l}));var a=n(13),r=n(17),o=n(3);function i(){return"".concat(Math.floor(4294967295*Math.random()).toString(36))}function c(e){return function e(t){return{id:i(),module:t.module,config:Object(a.cloneDeep)(t.config),children:t.children.map(e)}}(e)}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=o.a[e],c=Object(r.b)(a);return{id:i(),module:e,config:Object.assign({},c,t),children:n}}},17:function(e,t,n){"use strict";function a(e){var t={};return e.variables.forEach((function(e){t[e.name]=e.default})),t}n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}));var r=[{name:"seed",default:"",group:"Randomness"}]},25:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l}));var a=n(15),r=n(1),o=n(2),i=n(13),c=n(10),l=function(){function t(){Object(r.a)(this,t),this.tree=[],this.nodeCache={},this.treeUpdateListeners=[]}return Object(o.a)(t,[{key:"replaceTree",value:function(e){this.tree=Object(i.cloneDeep)(e),this.updateNodeCache(),this.invokeTreeUpdateListeners()}},{key:"updateNodeCache",value:function(){var e={};this.tree.forEach((function(t){return function t(n,a){e[n.id]={node:n,parent:a},n.children.forEach((function(e){return t(e,n)}))}(t,null)})),this.nodeCache=e}},{key:"invokeTreeUpdateListeners",value:function(){var t=this;e((function(){t.treeUpdateListeners.forEach((function(e){e(t.tree)}))}))}},{key:"getNodeOrNull",value:function(e){var t=this.getNodeCacheEntryUnsafe(e);return t?t.node:null}},{key:"getNodeParentOrNull",value:function(e){var t=this.getNodeCacheEntryUnsafe(e);return t?t.parent:null}},{key:"getNode",value:function(e){return this.getNodeCacheEntry(e).node}},{key:"getNodeParent",value:function(e){return this.getNodeCacheEntry(e).parent}},{key:"getNodeCacheEntryUnsafe",value:function(e){var t=this.nodeCache[e];return t||null}},{key:"getNodeCacheEntry",value:function(e){var t=this.getNodeCacheEntryUnsafe(e);if(null===t)throw new Error("invalid node ".concat(e));return t}},{key:"replaceOrEmsiblingNode",value:function(e,t,n,r){var o=null===e?this.tree:e.children,i=o.indexOf(t);i>-1&&(r?o.splice.apply(o,[i,1].concat(Object(a.a)(n))):o.splice.apply(o,[i,0].concat(Object(a.a)(n))))}},{key:"getTree",value:function(){return this.tree}},{key:"addTreeUpdateListener",value:function(e){this.treeUpdateListeners.push(e)}},{key:"changeNodeVariable",value:function(e,t,n){this.getNode(e).config[t]=n,this.invokeTreeUpdateListeners()}},{key:"addChildNode",value:function(e,t){var n=Object(c.a)(t,{});return this.addChildInternal(e,n),this.updateNodeCache(),this.invokeTreeUpdateListeners(),n}},{key:"addChildInternal",value:function(e,t){if(e){var n=this.getNode(e);return n.children.push(t),n}return this.tree.push(t),null}},{key:"wrapNode",value:function(e,t){var n=this.getNode(e),a=this.getNodeParent(e),r=Object(c.a)(t,{},[n]);return this.replaceOrEmsiblingNode(a,n,[r],!0),this.updateNodeCache(),this.invokeTreeUpdateListeners(),r}},{key:"deleteNode",value:function(e,t){var n=this.getNode(e),a=this.getNodeParent(e);this.replaceOrEmsiblingNode(a,n,t?[]:n.children,!0),this.updateNodeCache(),this.invokeTreeUpdateListeners()}},{key:"addSiblingNode",value:function(e,t){var n=Object(c.a)(t,{}),a=this.getNode(e),r=this.getNodeParent(e);this.replaceOrEmsiblingNode(r,a,[n],!1),this.updateNodeCache(),this.invokeTreeUpdateListeners()}},{key:"moveNode",value:function(e,t){if(e===t)return!1;var n=this.getNode(e),a=this.getNodeParent(e);return this.replaceOrEmsiblingNode(a,n,[],!0),this.addChildInternal(t,n),this.updateNodeCache(),this.invokeTreeUpdateListeners(),!0}},{key:"copyNode",value:function(e,t){var n=Object(c.b)(this.getNode(e));return this.addChildInternal(t,n),this.updateNodeCache(),this.invokeTreeUpdateListeners(),!0}}]),t}()}).call(this,n(36).setImmediate)},28:function(e,t,n){e.exports=n(46)},3:function(e,t,n){"use strict";var a=n(4),r=n(8),o={acceptsChildren:!0,variables:[{name:"number",default:"5"},{name:"variable",default:"i"}],render:function(e){for(var t=e.evaluateNodeConfig(),n=t.number,o=t.variable,i=[],c=Math.round(parseFloat(n)),l=e.node,d=0;d<c;d++){var u,s=e.subcontext(l,(u={},Object(a.a)(u,o,d),Object(a.a)(u,"".concat(o,"F"),d/(c-1)),u),"".concat(d));Object(r.a)(i,l.children,s)}return i}},i=n(27),c=Math.sqrt(3),l=c/2;function d(e,t,n){return"flat"===e||"flatRect"===e?("flatRect"===e&&(n-=t>>1),[1.5*t,l*t+c*n]):"pointy"===e||"pointyRect"===e?("pointyRect"===e&&(t-=n>>1),[c*t+l*n,1.5*n]):[0,0]}var u={acceptsChildren:!0,variables:[{name:"numberX",default:"5"},{name:"numberY",default:"5"},{name:"variableX",default:"vx"},{name:"variableY",default:"vy"},{name:"hex",default:"none",choices:["none","flat","flatRect","pointy","pointyRect"]}],render:function(e){var t=e.node,n=e.evaluateNodeConfig(t),o=n.numberX,c=n.numberY,l=n.variableX,u=n.variableY,s=n.hex,h=[];o=Math.round(parseFloat(o)),c=Math.round(parseFloat(c));for(var v=0;v<c;v++)for(var f=0;f<o;f++){var m,p=(m={},Object(a.a)(m,l,f),Object(a.a)(m,u,v),Object(a.a)(m,"".concat(l,"F"),f/(o-1)),Object(a.a)(m,"".concat(u,"F"),v/(c-1)),m);if("none"!==s){var g=d(s,f,v),b=Object(i.a)(g,2),y=b[0],N=b[1];p["".concat(l,"Hex")]=y,p["".concat(u,"Hex")]=N}var E=e.subcontext(t,p,"".concat(f,"x").concat(v));Object(r.a)(h,t.children,E)}return h}},s={acceptsChildren:!0,variables:[{name:"childIndex",default:"0"},{name:"indexVariable",default:"u"}],render:function(e){var t=e.node,n=e.evaluateNodeConfig(t),o=n.childIndex,i=n.indexVariable,c=parseInt(o,10),l=t.children[c%t.children.length],d=[];if(l){var u=e.subcontext(t,Object(a.a)({},i,o),"child".concat(o));Object(r.a)(d,[l],u)}return d}},h={acceptsChildren:!0,variables:[{name:"keep",default:"=rand() < .5"},{name:"indexVariable",default:"i"}],render:function(e){var t=e.node,n=e.evaluateFromNodeConfig("indexVariable"),o=[];Object(r.a)(o,t.children,e);var i=e.subcontext(t),c=t.config.keep||"";return o.filter((function(e,t){return i.evaluate("keep ".concat(t),c,Object(a.a)({},n,t))}))}},v=n(0),f="Transform",m=[{name:"x",default:"0",group:f},{name:"y",default:"0",group:f},{name:"r",default:"0",group:f},{name:"sx",default:"1",group:f},{name:"sy",default:"1",group:f}],p=n(7),g=function(e,t){return{a:e.a*t.a+e.c*t.b,b:e.b*t.a+e.d*t.b,c:e.a*t.c+e.c*t.d,d:e.b*t.c+e.d*t.d,e:e.a*t.e+e.c*t.f+e.e,f:e.b*t.e+e.d*t.f+e.f}};function b(e){var t=function(e){var t=e.x,n=e.y,a=e.r,r=e.sx,o=e.sy,i=Object(p.d)(isFinite(t)?t:0,isFinite(n)?n:0);return isFinite(a)&&(i=g(i,Object(p.a)(a))),isFinite(r)&&isFinite(o)&&(i=g(i,Object(p.b)(r,o))),i}(e),n=Object.assign({},e);return delete n.x,delete n.y,delete n.r,delete n.sx,delete n.sy,{matrix:t,props:n}}var y={acceptsChildren:!0,variables:m.concat([{name:"opacity",default:"1"}]),render:function(e){var t=e.renderChildren(),n=b(e.evaluateNodeConfig()),a=n.props,r=n.matrix,o=a.opacity;return[v.createElement("g",{transform:Object(p.c)(r),opacity:o},t)]}},N=[{name:"fill",default:"#333",group:"Presentation",type:"color"},{name:"stroke",default:"",group:"Presentation",type:"color"},{name:"strokeWidth",default:"0",group:"Presentation",type:"number"},{name:"opacity",default:"1",group:"Presentation",type:"number"}];var E={variables:m.concat(N).concat([{name:"radiusX",default:"20"},{name:"radiusY",default:"20"}]),render:function(e){var t=b(e.evaluateNodeConfig()),n=t.props,a=t.matrix,r=n.radiusX,o=""!==n.radiusY?n.radiusY:r;return delete n.radiusX,delete n.radiusY,function(e){""===e.stroke&&delete e.stroke,""===e.fill&&delete e.fill}(n),[v.createElement("ellipse",Object.assign({cx:0,cy:0,rx:r,ry:o,transform:Object(p.c)(a),key:e.getId()},n))]}};var C=2*Math.PI,k=function(e){var t={},n=function(){for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];var o=a.join("\x01");return o in t?t[o]:t[o]=e.apply(void 0,a)};return n.memo=t,n}((function(e,t,n,a,r){var o=[];t=parseFloat(t),n=parseFloat(n),a=parseFloat(a),r=parseFloat(r);for(var i=0;i<e;i++){var c=i%2===0?t:n,l=(i/e+(i%2===0?a:r))*C,d=Math.cos(l)*c,u=Math.sin(l)*c;isNaN(d)||isNaN(u)||o.push("".concat(0===i?"M":"L").concat(d.toFixed(3),",").concat(u.toFixed(3)))}return o.length>0&&o.push("z"),o.join(" ")})),O={Choose:s,Ellipse:E,LinearArray:o,Ngon:{variables:m.concat(N).concat([{name:"vertices",default:"5"},{name:"radius1",default:"5"},{name:"radius2",default:"5"},{name:"tilt1",default:"0"},{name:"tilt2",default:"0"}]),render:function(e){var t=e.node,n=b(e.evaluateNodeConfig(t)),a=n.props,r=n.matrix,o=k(a.vertices,a.radius1,a.radius2,a.tilt1,a.tilt2);return delete a.vertices,delete a.radius1,delete a.radius2,delete a.tilt1,delete a.tilt2,[v.createElement("path",Object.assign({d:o},a,{key:e.getId(t.id),transform:Object(p.c)(r)}))]}},Rect:{variables:m.concat(N).concat([{name:"width",default:"20"},{name:"height",default:"20"}]),render:function(e){var t=e.node,n=b(e.evaluateNodeConfig(t)),a=n.props,r=n.matrix;return[v.createElement("rect",Object.assign({x:-a.width/2,y:-a.height/2,transform:Object(p.c)(r),key:e.getId()},a))]}},RectArray:u,RemoveChildren:h,Xform:y};t.a=O;Object.keys(O).forEach((function(e){O[e].render.displayName="render_".concat(e)}))},45:function(e,t,n){},46:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n(23),o=n(1),i=n(2),c=n(6),l=n(5),d=n(24),u=function(e){var t=e.path,n=e.props;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},n),a.createElement("path",{d:t}))},s={fileTree:n(33),save:n(34),tune:n(35)},h=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var e=this,t=[{id:"tree",icon:s.fileTree},{id:"file",icon:s.save},{id:"gvars",icon:s.tune}];return a.createElement("div",{id:"global-toolbar",className:"toolbar"},t.map((function(t){return a.createElement("div",{key:t.id,className:d("btn",{active:e.props.activeTab===t.id}),title:t.id,onClick:function(){return e.props.onChangeTab(t.id)}},a.createElement(u,{path:t.icon}))})))}}]),n}(a.Component),v=n(25),f=n(26),m=n(11),p={width:800,height:800,background:"",gvars:[]};function g(e,t){var n=Object(m.a)({},e,{nodes:t});return Object(m.a)({version:"0.1"},n)}function b(e){if(Array.isArray(e))return Object(m.a)({},p,{nodes:Array.from(e)});if("object"!==typeof e)throw new Error("Not an object");if("0.1"===e.version){var t=Object(m.a)({},e);return delete t.version,Object(m.a)({},p,{},t)}throw new Error("Object version ".concat(e.version," not understood"))}var y=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={serializedState:""},e.dumpState=function(t){var n=g(e.props.document,e.props.treeManager.getTree());e.setState({serializedState:JSON.stringify(n,null,t.shiftKey?void 0:2)})},e.loadState=function(){var t;try{t=JSON.parse(e.state.serializedState)}catch(a){return void alert("Could not parse JSON: "+a)}try{var n=b(t);e.props.onLoadDocument(n)}catch(a){return void alert("Could not read document:"+a)}},e.saveSVG=function(){var t=f.renderToStaticMarkup(e.props.rendered).replace("<svg ",'<svg xmlns="http://www.w3.org/2000/svg" '),n=new Blob([t],{type:"image/svg+xml"}),a=URL.createObjectURL(n),r=Object.assign(document.createElement("a"),{download:"coil-svg-".concat(+new Date,".svg"),href:a});document.body.appendChild(r),r.click(),setTimeout((function(){var e=r.parentNode;e&&e.removeChild(r),URL.revokeObjectURL(a)}),100)},e}return Object(i.a)(n,[{key:"render",value:function(){var e=this;return a.createElement("div",{id:"file-panel"},a.createElement("div",null,a.createElement("button",{className:"btn standalone",onClick:this.dumpState},"Save state \u2193"),a.createElement("button",{className:"btn standalone",onClick:this.loadState},"Load state \u2191"),a.createElement("textarea",{value:this.state.serializedState,onChange:function(t){return e.setState({serializedState:t.target.value})}})),a.createElement("div",null,a.createElement("button",{className:"btn standalone",onClick:this.saveSVG},"Save rendered SVG...")))}}]),n}(a.Component),N=n(13),E=n(17),C=n(3),k=function(e){var t,n,r=e.name,o=e.choices,i=e.type,c=e.onChange,l=e.value;l=void 0===l?"":l;var d=function(e){return c(e.target.value.toString())};return n=o?a.createElement("select",{value:l,onChange:d},o.map((function(e){return a.createElement("option",{key:e,value:e},e)}))):a.createElement("input",{type:"text",value:l,onChange:d}),"color"===i&&(t=a.createElement("input",{type:"color",value:l,onChange:d})),a.createElement("tr",{className:"variable-config-row"},a.createElement("th",null,r),a.createElement("td",null,n),a.createElement("td",null,t))},O=function(e){var t=e.variable,n=e.nodeConfig,r=e.onChange;e.status;return a.createElement(k,{name:t.name,type:t.type||"string",value:n.config[t.name]||"",onChange:function(e){return r(n,t.name,e)},choices:t.choices})},j=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.nodeConfig,r=t.status,o=t.forceModule||C.a[n.module];if(!o)return a.createElement("div",null,"The module ",n.module," is not available.",a.createElement("textarea",null,JSON.stringify(n,null,2)));var i=o.variables.concat(o.noUniversalVariables?[]:E.a),c=Object(N.groupBy)(i,(function(e){return e.group||"Other"})),l=r.getVariablesForNode(n.id);return a.createElement("div",null,a.createElement("table",null,a.createElement("tbody",null,Object.keys(c).sort().map((function(t){return a.createElement(a.Fragment,{key:t},a.createElement("tr",{key:"#".concat(t),className:"group-separator"},a.createElement("th",{colSpan:3},t)),c[t].map((function(t){return a.createElement(O,{key:t.name,variable:t,nodeConfig:n,status:r,onChange:e.props.onChange})})))})))),l.length?a.createElement("div",{className:"debug"},"Variables last render: ",l.join(", ")):null,a.createElement("ul",{className:"errors"},r.getErrorsForNode(n.id).map((function(e,t){return a.createElement("li",{key:t},e)}))))}}]),n}(a.Component),w=function(e){var t=e.nodeConfig,n=e.selectedNode,r=e.onSelectNode,o=e.onRepositionNode;return a.createElement("li",{className:n===t?"selected":""},a.createElement("a",{href:"#",draggable:!0,onClick:function(e){r(t),e.preventDefault(),e.stopPropagation()},onDragStart:function(e){e.dataTransfer.clearData(),e.dataTransfer.setData("application/x-coil-nodeid",t.id),e.dataTransfer.effectAllowed="all"},onDragOver:function(e){e.dataTransfer.dropEffect="none",e.dataTransfer.types.includes("application/x-coil-nodeid")&&C.a[t.module].acceptsChildren&&(e.dataTransfer.dropEffect=e.altKey?"copy":"link",e.preventDefault())},onDrop:function(e){var n=e.dataTransfer.getData("application/x-coil-nodeid");e.dataTransfer.dropEffect=e.altKey?"copy":"link";var a="copy"===e.dataTransfer.dropEffect;o(n,t.id,a)}},t.module),t.children.length?a.createElement(S,{nodeConfigs:t.children,selectedNode:n,onSelectNode:r,onRepositionNode:o}):null)},S=function(e){var t=e.nodeConfigs,n=e.selectedNode,r=e.onSelectNode,o=e.onRepositionNode;return a.createElement("ul",null,t.map((function(e){return a.createElement(w,{key:e.id,nodeConfig:e,selectedNode:n,onSelectNode:r,onRepositionNode:o})})))},x=function(e){var t=e.nodeConfigs,n=e.selectedNode,r=e.onSelectNode,o=e.onRepositionNode;return a.createElement("div",{id:"tree",onClick:function(e){"tree"===e.currentTarget.id&&r(null)}},a.createElement(S,{nodeConfigs:t,selectedNode:n,onSelectNode:r,onRepositionNode:o}))},D=n(9),T=n.n(D);function M(e){return e&&C.a[e.module]&&C.a[e.module].acceptsChildren}var F=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).dropdowns={},e}return Object(i.a)(n,[{key:"handleAddNode",value:function(e,t){var n=this.props,a=n.treeManager,r=n.selectedNode;switch(e){case"child":a.addChildNode(r?r.id:null,t);break;case"sibling":r&&a.addSiblingNode(r.id,t);break;case"wrap":r&&a.wrapNode(r.id,t)}this.hideDropdowns()}},{key:"handleDeleteNode",value:function(e){var t=this.props,n=t.treeManager,a=t.selectedNode;a&&n.deleteNode(a.id,e)}},{key:"hideDropdowns",value:function(){Object.values(this.dropdowns).forEach((function(e){return e.hide()}))}},{key:"render",value:function(){var e,t=this,n=this.props.selectedNode,r="Node",o=!1;if(null===n&&(e="child",r="Node"),M(n)&&(e="child",r="Child"),n){var i=this.props.treeManager.getNodeParentOrNull(n.id);(null===i||M(i))&&(o=!0)}return a.createElement("div",{id:"tree-toolbar",className:"toolbar"},a.createElement(T.a,{disabled:!n,ref:function(e){t.dropdowns.wrap=e}},a.createElement(D.DropdownTrigger,{className:"btn"},"Wrap..."),a.createElement(D.DropdownContent,{className:"node-select"},Object.keys(C.a).filter((function(e){return C.a[e].acceptsChildren})).map((function(e){return a.createElement("a",{href:"#",key:e,onClick:function(){return t.handleAddNode("wrap",e)}},e)})))),a.createElement(T.a,{disabled:!e,ref:function(e){t.dropdowns.addChild=e}},a.createElement(D.DropdownTrigger,{className:"btn"},"Add ",r,"..."),a.createElement(D.DropdownContent,{className:"node-select"},Object.keys(C.a).map((function(e){return a.createElement("a",{href:"#",key:e,onClick:function(){return t.handleAddNode("child",e)}},e)})))),a.createElement(T.a,{disabled:!o,ref:function(e){t.dropdowns.addSibling=e}},a.createElement(D.DropdownTrigger,{className:"btn"},"Add Sibling..."),a.createElement(D.DropdownContent,{className:"node-select"},Object.keys(C.a).map((function(e){return a.createElement("a",{href:"#",key:e,onClick:function(){return t.handleAddNode("sibling",e)}},e)})))),a.createElement("div",{className:"btn "+(n?"":"disabled"),title:"Shift-click to delete with hierarchy",onClick:function(e){t.handleDeleteNode(e.shiftKey),e.preventDefault()}},"Delete"))}}]),n}(a.Component),V={variables:[{group:"Document",name:"width",default:"800"},{group:"Document",name:"height",default:"800"},{group:"Document",name:"background",default:"",type:"color"}],acceptsChildren:!1,noUniversalVariables:!0,render:function(e){throw new Error("Document.render() should not be called")}},A=function(e){var t=e.gvar,n=e.onChange;return a.createElement("div",{className:"quick-gvar"},a.createElement("span",null,t.name),"number"===t.type?a.createElement("input",{type:"range",min:t.min,max:t.max,step:"any",value:t.value,onChange:function(e){return n(t,e.target.valueAsNumber)}}):null)},U=function(e){var t=e.gvars,n=e.onChange;return a.createElement("div",{className:"quick-gvar-bar"},t.map((function(e){return a.createElement(A,{gvar:e,key:e.name,onChange:n})})))},L=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).onChangeNodeVariable=function(t,n,a){e.props.treeManager.changeNodeVariable(t.id,n,a),e.forceUpdate()},e.onChangeDocumentVariable=function(t,n,a){e.props.onChangeDocumentVariable(n,a.replace(/^=/,"")),e.forceUpdate()},e.onRepositionNode=function(t,n,a){a?e.props.treeManager.copyNode(t,n):e.props.treeManager.moveNode(t,n)},e}return Object(i.a)(n,[{key:"render",value:function(){var e=this.props,t=e.treeManager,n=e.selectedNodeId,r=e.status,o=e.document,i=e.onChangeGvarValue,c=n?t.getNodeOrNull(n):null;return a.createElement(a.Fragment,null,a.createElement("div",{id:"hierarchy"},a.createElement(F,{treeManager:t,selectedNode:c}),a.createElement(x,{nodeConfigs:t.getTree(),selectedNode:c,onSelectNode:this.props.onSelectNode,onRepositionNode:this.onRepositionNode})),a.createElement("div",{id:"props"},c?a.createElement(j,{nodeConfig:c,status:r,onChange:this.onChangeNodeVariable}):a.createElement(j,{nodeConfig:{module:"~Document~",id:"~Document~",config:{width:""+o.width,height:""+o.height,background:""+o.background},children:[]},status:r,forceModule:V,onChange:this.onChangeDocumentVariable})),a.createElement(U,{gvars:o.gvars,onChange:i}))}}]),n}(a.Component),R={};function G(e,t){return e.startsWith("=")?(e in R?R[e]:R[e]=new Function("namespace","with(namespace) { return ".concat(e.slice(1),"}")))(t()):/[+-][0-9.]+/.test(e)?parseFloat(e):"".concat(e)}function I(e){var t=e?function(e){for(var t=0,n=0;n<e.length;n++)t^=n%16<<e.charCodeAt(n);return t}(e):2147483647*Math.random();return function(){return((t=16807*t%2147483647)-1)/2147483646}}var P=n(8);function X(e,t,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;try{return G(a,r)}catch(i){return e.addError(t.id,"".concat(n,": ").concat(i)),console.warn(i),o}}var Y=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";Object(o.a)(this,e),this.status=t,this.node=n,this.parent=a,this.variables=r,this.idPrefix=i,this.rng=void 0,this.defaultNamespace=this.prepareNamespace()}return Object(i.a)(e,[{key:"subcontext",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=Object.assign({},this.variables,n);return new e(this.status,t,this,r,"".concat(this.idPrefix,".").concat(a))}},{key:"random",value:function(e,t){if(!this.rng){var n=this.evaluateFromNodeConfig("seed");this.rng=I(n)}var a=this.rng();return void 0!==e?void 0===t?a*e:e+a*(t-e):a}},{key:"prepareNamespace",value:function(e){var t=this;return function(e){var t;return function(){return void 0===t&&(t=e()),t}}((function(){return Object(m.a)({rand:t.random.bind(t)},t.variables,{},e)}))}},{key:"evaluateFromNodeConfig",value:function(e){var t=this.node.config[e];return void 0===t?null:X(this.status,this.node,e,String(t),this.defaultNamespace)}},{key:"evaluate",value:function(e,t,n){var a=this.prepareNamespace(n);return X(this.status,this.node,e,t,a)}},{key:"evaluateAll",value:function(e,t,n){var a={},r=this.prepareNamespace(n);for(var o in t)if(t.hasOwnProperty(o)){var i=t[o];null!==i&&(a[o]=X(this.status,this.node,o,i,r))}return a}},{key:"evaluateNodeConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.node;return this.evaluateAll(e,e.config)}},{key:"getId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.node.id;return this.idPrefix+e}},{key:"renderChildren",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=[];return Object(P.a)(t,this.node.children,e),t}}]),e}(),J=function(){function e(){Object(o.a)(this,e),this.nodeErrors={},this.nodeVariables={}}return Object(i.a)(e,[{key:"addError",value:function(e,t){e in this.nodeErrors||(this.nodeErrors[e]=[]),this.nodeErrors[e].push(t)}},{key:"getErrorsForNode",value:function(e){return e in this.nodeErrors?this.nodeErrors[e]:[]}},{key:"addVariables",value:function(e,t){e in this.nodeVariables||(this.nodeVariables[e]=[]),this.nodeVariables[e].push(Object.assign({},t))}},{key:"getVariablesForNode",value:function(e){if(!(e in this.nodeVariables))return[];var t=new Set;return this.nodeVariables[e].forEach((function(e){Object.keys(e).forEach((function(e){return t.add(e)}))})),Array.from(t).sort()}}]),e}(),z=n(10);function B(e){var t=e.gvar,n=e.onModifyGvar,r=e.onDeleteGvar;return a.createElement("div",{className:"gvar-panel",style:{display:"flex"}},a.createElement("button",{className:"btn standalone",title:"Delete gvar",onClick:function(){return r(t)}},"\xd7"),a.createElement("table",{className:"var-table",style:{flex:1}},a.createElement("tbody",null,a.createElement(k,{name:"name",type:"string",value:t.name,onChange:function(e){return n(t,"name",e)}}),a.createElement(k,{name:"type",type:"string",choices:["number","string"],value:t.type,onChange:function(e){return n(t,"type",e)}}),a.createElement(k,{name:"value",type:"string",value:t.value,onChange:function(e){return n(t,"value",e)}}),"number"===t.type?a.createElement(a.Fragment,null,a.createElement(k,{name:"min",type:"string",value:t.min,onChange:function(e){return n(t,"min",parseFloat(e))}}),a.createElement(k,{name:"max",type:"string",value:t.max,onChange:function(e){return n(t,"max",parseFloat(e))}})):null)))}var K=function(e){var t=e.document;return a.createElement("div",{id:"gvars-panel"},a.createElement("div",{id:"gvars-toolbar",className:"toolbar"},a.createElement("div",{className:"btn",onClick:function(t){e.onAddGvar(),t.preventDefault()}},"Add new gvar")),t.gvars&&t.gvars.length?t.gvars.map((function(t,n){return a.createElement(B,{key:n,gvar:t,onModifyGvar:e.onModifyGvar,onDeleteGvar:e.onDeleteGvar})})):a.createElement("i",null,"No gvars specified"))};function q(e,t){var n=e.indexOf(t);return n>-1&&(e.splice(n,1),!0)}var W=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).treeManager=new v.a,e.state={selectedNodeId:null,rendered:null,status:new J,activeTab:"tree",document:{nodes:[],width:800,height:800,background:"",gvars:[]}},e.loadDocument=function(t){var n=t.nodes;t.nodes=[],e.setState({document:t}),e.treeManager.replaceTree(n)},e.onSelectNode=function(t){e.setState({selectedNodeId:t?t.id:null})},e.onChangeTab=function(t){e.setState({activeTab:t})},e.onChangeDocumentVariable=function(t,n){var a=e.state.document;switch(t){case"width":case"height":a[t]=parseInt(n,10);break;default:a[t]=n}e.setState({document:a},(function(){e.redrawCurrent()}))},e.onAddGvar=function(){var t=e.state.document;t.gvars.push({name:function(){for(var e=function(e){var n="".concat(String.fromCharCode(97+t.gvars.length));return t.gvars.some((function(e){return e.name===n}))?"continue":{v:n}},n=0;;n++){var a=e();switch(a){case"continue":continue;default:if("object"===typeof a)return a.v}}}(),type:"number",min:0,max:1,value:0}),e.setState({document:t})},e.onModifyGvar=function(t,n,a){var r=e.state.document;r.gvars.includes(t)&&(t[n]=a,e.setState({document:r},(function(){"value"===n&&e.redrawCurrent()})))},e.onChangeGvarValue=function(t,n){var a=e.state.document;if(a.gvars.includes(t)){if("number"===t.type){var r=parseFloat(n);if(isNaN(r))return;t.value=r}e.setState({document:a},(function(){e.redrawCurrent()}))}},e.onDeleteGvar=function(t){var n=e.state.document;q(n.gvars,t)&&e.setState({document:n},(function(){e.redrawCurrent()}))},e}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.treeManager.addTreeUpdateListener((function(t){e.renderDrawing(t)})),this.treeManager.addTreeUpdateListener((function(t){e.saveToStorage(t)})),this.loadFromStorage()}},{key:"saveToStorage",value:function(e){var t,n;t="coilSave",void 0!==(n=g(this.state.document,e||this.treeManager.getTree()))&&null!==n?localStorage.setItem(t,JSON.stringify(n)):localStorage.removeItem(t)}},{key:"loadFromStorage",value:function(){var e=function(e){var t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(n){return}}("coilSave");if(e)try{var t=b(e);this.loadDocument(t)}catch(n){alert("Loading document from storage failed: "+n)}else this.treeManager.replaceTree([Object(z.a)("RemoveChildren",{seed:"foo"},[Object(z.a)("RectArray",{numberX:"7",numberY:"7",variableX:"i",variableY:"j"},[Object(z.a)("Ngon",{radius1:"15",radius2:"5",vertices:"10",x:"=15 + i * 30",y:"=30 + j * 30",fill:"blue"})])])])}},{key:"renderDrawing",value:function(e){var t,n=new J,r=new Y(n,{id:"root",module:"root",config:{},children:e}),o=this.state.document,i=o.width,c=o.height,l=o.background;o.gvars.forEach((function(e){r.variables[e.name]=e.value}));try{t=r.renderChildren()}catch(u){t=a.createElement("text",{y:50,x:50},u.toString()),console.error(t)}var d=a.createElement("svg",{width:i,height:c,viewBox:"0 0 ".concat(i," ").concat(c)},l?a.createElement("rect",{x:0,y:0,width:i,height:c,fill:l,id:"background"}):null,t);this.setState({rendered:d,status:n})}},{key:"redrawCurrent",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.treeManager.getTree();this.renderDrawing(t),e&&this.saveToStorage(t)}},{key:"render",value:function(){var e=this.state,t=e.rendered,n=e.activeTab,r=e.document,o=null;switch(n){case"tree":o=a.createElement(L,{document:r,treeManager:this.treeManager,status:this.state.status,selectedNodeId:this.state.selectedNodeId,onSelectNode:this.onSelectNode,onChangeDocumentVariable:this.onChangeDocumentVariable,onChangeGvarValue:this.onChangeGvarValue});break;case"file":o=a.createElement(y,{treeManager:this.treeManager,rendered:t,document:r,onLoadDocument:this.loadDocument});break;case"gvars":o=a.createElement(K,{document:r,onAddGvar:this.onAddGvar,onModifyGvar:this.onModifyGvar,onDeleteGvar:this.onDeleteGvar})}return a.createElement(a.Fragment,null,a.createElement("div",{id:"config"},a.createElement(h,{activeTab:n,onChangeTab:this.onChangeTab}),o),a.createElement("div",{id:"drawing"},t))}}]),n}(a.Component),H=(n(45),document.createElement("div"));H.id="wrapper",document.body.appendChild(H),r.render(a.createElement(W,null),H)},8:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(3);function r(e,t){var n=a.a[t.module];if(!n)throw new Error("not registered ".concat(t.module));try{return e.status.addVariables(t.id,e.variables),n.render(e.subcontext(t,{},t.id))}catch(r){return console.error(r),[]}}function o(e,t,n){for(var a=0;a<t.length;a++)for(var o=r(n,t[a]),i=0;i<o.length;i++)e.push(o[i])}}},[[28,1,2]]]);
//# sourceMappingURL=main.c8f67172.chunk.js.map