!function(e){function t(t){for(var r,i,u=t[0],l=t[1],c=t[2],s=0,f=[];s<u.length;s++)i=u[s],a[i]&&f.push(a[i][0]),a[i]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(d&&d(t);f.length;)f.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,u=1;u<n.length;u++){var l=n[u];0!==a[l]&&(r=!1)}r&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},a={1:0},o=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="./";var u=window.webpackJsonp=window.webpackJsonp||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var c=0;c<u.length;c++)t(u[c]);var d=l;o.push([77,0]),n()}([,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3);function a(e,t){var n=r.default[t.module];if(!n)throw new Error("not registered "+t.module);try{return e.status.addVariables(t.id,e.variables),n.render(e.subcontext(t,{},t.id))}catch(e){return console.error(e),[]}}t.renderNode=a,t.renderNodesInto=function(e,t,n){for(var r=0;r<t.length;r++)for(var o=a(n,t[r]),i=0;i<o.length;i++)e.push(o[i])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(56),a=n(55),o=n(54),i=n(53),u=n(52),l=n(51),c=n(49),d=n(47),s={Choose:o.default,Ellipse:l.default,LinearArray:r.default,Ngon:c.default,Rect:d.default,RectArray:a.default,RemoveChildren:i.default,Xform:u.default};t.default=s,Object.keys(s).forEach(function(e){s[e].render.displayName="render_"+e})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),a=function(e,t){return{a:e.a*t.a+e.c*t.b,b:e.b*t.a+e.d*t.b,c:e.a*t.c+e.c*t.d,d:e.b*t.c+e.d*t.d,e:e.a*t.e+e.c*t.f+e.e,f:e.b*t.e+e.d*t.f+e.f}};function o(e){var t=e.x,n=e.y,o=e.r,i=e.sx,u=e.sy,l=r.translate(isFinite(t)?t:0,isFinite(n)?n:0);return isFinite(o)&&(l=a(l,r.rotateDEG(o))),isFinite(i)&&isFinite(u)&&(l=a(l,r.scale(i,u))),l}t.makeMatrix=o,t.splitMatrixAndProps=function(e){var t=o(e),n=Object.assign({},e);return delete n.x,delete n.y,delete n.r,delete n.sx,delete n.sy,{matrix:t,props:n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="Transform";t.default=[{name:"x",default:"0",group:r},{name:"y",default:"0",group:r},{name:"r",default:"0",group:r},{name:"sx",default:"1",group:r},{name:"sy",default:"1",group:r}]},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="Presentation";t.default=[{name:"fill",default:"#333",group:r,type:"color"},{name:"stroke",default:"",group:r,type:"color"},{name:"strokeWidth",default:"0",group:r,type:"number"},{name:"opacity",default:"1",group:r,type:"number"}]},,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){var t=e.name,n=e.choices,a=e.type,o=e.onChange,i=e.value,u=null,l=null;i=void 0===i?"":i;var c=function(e){return o(e.target.value.toString())};return l=n?r.createElement("select",{value:i,onChange:c},n.map(function(e){return r.createElement("option",{key:e,value:e},e)})):r.createElement("input",{type:"text",value:i,onChange:c}),"color"===a&&(u=r.createElement("input",{type:"color",value:i,onChange:c})),r.createElement("tr",{className:"variable-config-row"},r.createElement("th",null,t),r.createElement("td",null,l),r.createElement("td",null,u))}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a="0.1",o={width:800,height:800,background:"",gvars:[]};t.serialize=function(e,t){var n=r({},e,{nodes:t});return r({version:a},n)},t.deserialize=function(e){if(Array.isArray(e))return r({},o,{nodes:Array.from(e)});if("object"!=typeof e)throw new Error("Not an object");if(e.version===a){var t=r({},e);return delete t.version,r({},o,t)}throw new Error("Object version "+e.version+" not understood")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getVariableDefaults=function(e){var t={};return e.variables.forEach(function(e){t[e.name]=e.default}),t},t.UniversalVariables=[{name:"seed",default:"",group:"Randomness"}]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),a=n(16),o=n(3);function i(){return""+Math.floor(4294967295*Math.random()).toString(36)}t.duplicate=function(e){return function e(t){return{id:i(),module:t.module,config:r.cloneDeep(t.config),children:t.children.map(e)}}(e)},t.configure=function(e,t,n){void 0===n&&(n=[]);var r=o.default[e],u=a.getVariableDefaults(r);return{id:i(),module:e,config:Object.assign({},u,t),children:n}}},,,,function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeInPlace=function(e,t){var n=e.indexOf(t);return n>-1&&(e.splice(n,1),!0)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=n(14);function o(e){var t=e.gvar,n=e.onModifyGvar,o=e.onDeleteGvar;return r.createElement("div",{className:"gvar-panel",style:{display:"flex"}},r.createElement("button",{className:"btn standalone",title:"Delete gvar",onClick:function(){return o(t)}},"×"),r.createElement("table",{className:"var-table",style:{flex:1}},r.createElement("tbody",null,r.createElement(a.default,{name:"name",type:"string",value:t.name,onChange:function(e){return n(t,"name",e)}}),r.createElement(a.default,{name:"type",type:"string",choices:["number","string"],value:t.type,onChange:function(e){return n(t,"type",e)}}),r.createElement(a.default,{name:"value",type:"string",value:t.value,onChange:function(e){return n(t,"value",e)}}),"number"===t.type?r.createElement(r.Fragment,null,r.createElement(a.default,{name:"min",type:"string",value:t.min,onChange:function(e){return n(t,"min",parseFloat(e))}}),r.createElement(a.default,{name:"max",type:"string",value:t.max,onChange:function(e){return n(t,"max",parseFloat(e))}})):null)))}t.default=function(e){var t=e.document;return r.createElement("div",{id:"gvars-panel"},r.createElement("div",{id:"gvars-toolbar",className:"toolbar"},r.createElement("div",{className:"btn",onClick:function(t){e.onAddGvar(),t.preventDefault()}},"Add new gvar")),t.gvars&&t.gvars.length?t.gvars.map(function(t,n){return r.createElement(o,{key:n,gvar:t,onModifyGvar:e.onModifyGvar,onDeleteGvar:e.onDeleteGvar})}):r.createElement("i",null,"No gvars specified"))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e){var t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(e){return}},t.save=function(e,t){void 0!==t&&null!==t?localStorage.setItem(e,JSON.stringify(t)):localStorage.removeItem(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17);t.default=function(){return[r.configure("RemoveChildren",{seed:"foo"},[r.configure("RectArray",{numberX:"7",numberY:"7",variableX:"i",variableY:"j"},[r.configure("Ngon",{radius1:"15",radius2:"5",vertices:"10",x:"=15 + i * 30",y:"=30 + j * 30",fill:"blue"})])])]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.nodeErrors={},this.nodeVariables={}}return e.prototype.addError=function(e,t){e in this.nodeErrors||(this.nodeErrors[e]=[]),this.nodeErrors[e].push(t)},e.prototype.getErrorsForNode=function(e){return e in this.nodeErrors?this.nodeErrors[e]:[]},e.prototype.addVariables=function(e,t){e in this.nodeVariables||(this.nodeVariables[e]=[]),this.nodeVariables[e].push(Object.assign({},t))},e.prototype.getVariablesForNode=function(e){if(!(e in this.nodeVariables))return[];var t=new Set;return this.nodeVariables[e].forEach(function(e){Object.keys(e).forEach(function(e){return t.add(e)})}),Array.from(t).sort()},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e?function(e){for(var t=0,n=0;n<e.length;n++)t^=n%16<<e.charCodeAt(n);return t}(e):2147483647*Math.random();return function(){return((t=16807*t%2147483647)-1)/2147483646}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};t.evaluateExpression=function(e,t){return e.startsWith("=")?(e in r?r[e]:r[e]=new Function("namespace","with(namespace) { return "+e.slice(1)+"}"))(t()):/[+-][0-9.]+/.test(e)?parseFloat(e):""+e}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(28),o=n(27),i=n(2);function u(e,t,n,r,o,i){void 0===i&&(i=null);try{return a.evaluateExpression(r,o)}catch(r){return e.addError(t.id,n+": "+r),console.warn(r),i}}var l=function(){function e(e,t,n,r,a){void 0===n&&(n=null),void 0===r&&(r={}),void 0===a&&(a=""),this.status=e,this.node=t,this.parent=n,this.variables=r,this.idPrefix=a,this.defaultNamespace=this.prepareNamespace()}return e.prototype.subcontext=function(t,n,r){void 0===n&&(n={}),void 0===r&&(r="");var a=Object.assign({},this.variables,n);return new e(this.status,t,this,a,this.idPrefix+"."+r)},e.prototype.random=function(e,t){if(!this.rng){var n=this.evaluateFromNodeConfig("seed");this.rng=o.default(n)}var r=this.rng();return void 0!==e?void 0===t?r*e:e+r*(t-e):r},e.prototype.prepareNamespace=function(e){var t=this;return function(e){var t;return function(){return void 0===t&&(t=e()),t}}(function(){return r({rand:t.random.bind(t)},t.variables,e)})},e.prototype.evaluateFromNodeConfig=function(e){var t=this.node.config[e];return void 0===t?null:u(this.status,this.node,e,t,this.defaultNamespace)},e.prototype.evaluate=function(e,t,n){var r=this.prepareNamespace(n);return u(this.status,this.node,e,t,r)},e.prototype.evaluateAll=function(e,t,n){var r={},a=this.prepareNamespace(n);for(var o in t)if(t.hasOwnProperty(o)){var i=t[o];null!==i&&(r[o]=u(this.status,this.node,o,i,a))}return r},e.prototype.evaluateNodeConfig=function(e){return void 0===e&&(e=this.node),this.evaluateAll(e,e.config)},e.prototype.getId=function(e){return void 0===e&&(e=this.node.id),this.idPrefix+e},e.prototype.renderChildren=function(e){void 0===e&&(e=this);var t=[];return i.renderNodesInto(t,this.node.children,e),t},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=function(e){var t=e.gvar,n=e.onChange;return r.createElement("div",{className:"quick-gvar"},r.createElement("span",null,t.name),"number"===t.type?r.createElement("input",{type:"range",min:t.min,max:t.max,value:t.value,onChange:function(e){return n(t,e.target.valueAsNumber)}}):null)};t.default=function(e){var t=e.gvars,n=e.onChange;return r.createElement("div",{className:"quick-gvar-bar"},t.map(function(e){return r.createElement(a,{gvar:e,key:e.name,onChange:n})}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={variables:[{group:"Document",name:"width",default:"800"},{group:"Document",name:"height",default:"800"},{group:"Document",name:"background",default:"",type:"color"}],acceptsChildren:!1,noUniversalVariables:!0,render:function(e){throw new Error("Document.render() should not be called")}}},,,,,,function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(36),i=n(3);function u(e){return e&&i.default[e.module]&&i.default[e.module].acceptsChildren}var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dropdowns={},t}return r(t,e),t.prototype.handleAddNode=function(e,t){var n=this.props,r=n.treeManager,a=n.selectedNode;switch(e){case"child":r.addChildNode(a?a.id:null,t);break;case"sibling":r.addSiblingNode(a.id,t);break;case"wrap":r.wrapNode(a.id,t)}this.hideDropdowns()},t.prototype.handleDeleteNode=function(e){var t=this.props,n=t.treeManager,r=t.selectedNode;n.deleteNode(r.id,e)},t.prototype.hideDropdowns=function(){Object.values(this.dropdowns).forEach(function(e){return e.hide()})},t.prototype.render=function(){var e=this,t=this.props.selectedNode,n=null,r="Node",l=!1;if(null===t&&(n="child",r="Node"),u(t)&&(n="child",r="Child"),t){var c=this.props.treeManager.getNodeParentOrNull(t.id);(null===c||u(c))&&(l=!0)}return a.createElement("div",{id:"tree-toolbar",className:"toolbar"},a.createElement(o.default,{disabled:!t,ref:function(t){e.dropdowns.wrap=t}},a.createElement(o.DropdownTrigger,{className:"btn"},"Wrap..."),a.createElement(o.DropdownContent,{className:"node-select"},Object.keys(i.default).filter(function(e){return i.default[e].acceptsChildren}).map(function(t){return a.createElement("a",{href:"#",key:t,onClick:function(){return e.handleAddNode("wrap",t)}},t)}))),a.createElement(o.default,{disabled:!n,ref:function(t){e.dropdowns.addChild=t}},a.createElement(o.DropdownTrigger,{className:"btn"},"Add ",r,"..."),a.createElement(o.DropdownContent,{className:"node-select"},Object.keys(i.default).map(function(t){return a.createElement("a",{href:"#",key:t,onClick:function(){return e.handleAddNode("child",t)}},t)}))),a.createElement(o.default,{disabled:!l,ref:function(t){e.dropdowns.addSibling=t}},a.createElement(o.DropdownTrigger,{className:"btn"},"Add Sibling..."),a.createElement(o.DropdownContent,{className:"node-select"},Object.keys(i.default).map(function(t){return a.createElement("a",{href:"#",key:t,onClick:function(){return e.handleAddNode("sibling",t)}},t)}))),a.createElement("div",{className:"btn "+(t?"":"disabled"),title:"Shift-click to delete with hierarchy",onClick:function(t){e.handleDeleteNode(t.shiftKey),t.preventDefault()}},"Delete"))},t}(a.Component);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=n(3),o=function(e){var t=e.nodeConfig,n=e.selectedNode,o=e.onSelectNode,u=e.onRepositionNode;return r.createElement("li",{className:n===t?"selected":""},r.createElement("a",{href:"#",draggable:!0,onClick:function(e){o(t),e.preventDefault(),e.stopPropagation()},onDragStart:function(e){e.dataTransfer.clearData(),e.dataTransfer.setData("application/x-coil-nodeid",t.id),e.dataTransfer.effectAllowed="all"},onDragOver:function(e){e.dataTransfer.dropEffect="none",e.dataTransfer.types.indexOf("application/x-coil-nodeid")>-1&&a.default[t.module].acceptsChildren&&(e.dataTransfer.dropEffect=e.altKey?"copy":"link",e.preventDefault())},onDrop:function(e){var n=e.dataTransfer.getData("application/x-coil-nodeid");e.dataTransfer.dropEffect=e.altKey?"copy":"link";var r="copy"===e.dataTransfer.dropEffect;u(n,t.id,r)}},t.module),t.children.length?r.createElement(i,{nodeConfigs:t.children,selectedNode:n,onSelectNode:o,onRepositionNode:u}):null)},i=function(e){var t=e.nodeConfigs,n=e.selectedNode,a=e.onSelectNode,i=e.onRepositionNode;return r.createElement("ul",null,t.map(function(e){return r.createElement(o,{key:e.id,nodeConfig:e,selectedNode:n,onSelectNode:a,onRepositionNode:i})}))};t.default=function(e){var t=e.nodeConfigs,n=e.selectedNode,a=e.onSelectNode,o=e.onRepositionNode;return r.createElement("div",{id:"tree",onClick:function(e){"tree"===e.currentTarget.id&&a(null)}},r.createElement(i,{nodeConfigs:t,selectedNode:n,onSelectNode:a,onRepositionNode:o}))}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),o=n(0),i=n(16),u=n(3),l=n(14),c=function(e){var t=e.variable,n=e.nodeConfig,r=e.onChange;e.status;return o.createElement(l.default,{name:t.name,type:t.type,value:n.config[t.name]||"",onChange:function(e){return r(n,t.name,e)},choices:t.choices})},d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.nodeConfig,r=t.status,l=t.forceModule||u.default[n.module];if(!l)return o.createElement("div",null,"The module ",n.module," is not available.",o.createElement("textarea",null,JSON.stringify(n,null,2)));var d=l.variables.concat(l.noUniversalVariables?[]:i.UniversalVariables),s=a.groupBy(d,function(e){return e.group||"Other"}),f=r.getVariablesForNode(n.id);return o.createElement("div",null,o.createElement("table",null,o.createElement("tbody",null,Object.keys(s).sort().map(function(t){return o.createElement(o.Fragment,{key:t},o.createElement("tr",{key:"#"+t,className:"group-separator"},o.createElement("th",{colSpan:3},t)),s[t].map(function(t){return o.createElement(c,{key:t.name,variable:t,nodeConfig:n,status:r,onChange:e.props.onChange})}))}))),f.length?o.createElement("div",{className:"debug"},"Variables last render: ",f.join(", ")):null,o.createElement("ul",{className:"errors"},r.getErrorsForNode(n.id).map(function(e,t){return o.createElement("li",{key:t},e)})))},t}(o.Component);t.default=d},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(39),i=n(38),u=n(37),l=n(31),c=n(30),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeNodeVariable=function(e,n,r){t.props.treeManager.changeNodeVariable(e.id,n,r),t.forceUpdate()},t.onChangeDocumentVariable=function(e,n,r){t.props.onChangeDocumentVariable(n,r.replace(/^=/,"")),t.forceUpdate()},t.onRepositionNode=function(e,n,r){r?t.props.treeManager.copyNode(e,n):t.props.treeManager.moveNode(e,n)},t}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.treeManager,n=e.selectedNodeId,r=e.status,d=e.document,s=e.onChangeGvarValue,f=t.getNodeOrNull(n);return a.createElement(a.Fragment,null,a.createElement("div",{id:"hierarchy"},a.createElement(u.default,{treeManager:t,selectedNode:f}),a.createElement(i.default,{nodeConfigs:t.getTree(),selectedNode:f,onSelectNode:this.props.onSelectNode,onRepositionNode:this.onRepositionNode})),a.createElement("div",{id:"props"},f?a.createElement(o.default,{nodeConfig:f,status:r,onChange:this.onChangeNodeVariable}):a.createElement(o.default,{nodeConfig:{module:"~Document~",id:"~Document~",config:{width:""+d.width,height:""+d.height,background:""+d.background},children:[]},status:r,forceModule:l.default,onChange:this.onChangeDocumentVariable})),a.createElement(c.default,{gvars:d.gvars,onChange:s}))},t}(a.Component);t.default=d},,,,,,function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(45),i=n(15),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={serializedState:""},t.dumpState=function(e){var n=i.serialize(t.props.document,t.props.treeManager.getTree());t.setState({serializedState:JSON.stringify(n,null,e.shiftKey?void 0:2)})},t.loadState=function(){var e;try{e=JSON.parse(t.state.serializedState)}catch(e){return void alert("Could not parse JSON: "+e)}try{var n=i.deserialize(e);t.props.onLoadDocument(n)}catch(e){return void alert("Could not read document:"+e)}},t.saveSVG=function(){var e=o.renderToStaticMarkup(t.props.rendered).replace("<svg ",'<svg xmlns="http://www.w3.org/2000/svg" '),n=new Blob([e],{type:"image/svg+xml"}),r=URL.createObjectURL(n),a=Object.assign(document.createElement("a"),{download:"coil-svg-"+ +new Date+".svg",href:r});document.body.appendChild(a),a.click(),setTimeout(function(){a.parentNode.removeChild(a),URL.revokeObjectURL(r)},100)},t}return r(t,e),t.prototype.render=function(){var e=this,t=this.props;t.treeManager,t.rendered;return a.createElement("div",{id:"file-panel"},a.createElement("div",null,a.createElement("button",{className:"btn standalone",onClick:this.dumpState},"Save state ↓"),a.createElement("button",{className:"btn standalone",onClick:this.loadState},"Load state ↑"),a.createElement("textarea",{value:this.state.serializedState,onChange:function(t){return e.setState({serializedState:t.target.value})}})),a.createElement("div",null,a.createElement("button",{className:"btn standalone",onClick:this.saveSVG},"Save rendered SVG...")))},t}(a.Component);t.default=u},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(1),i=n(5),u=n(4),l=n(7);t.default={variables:i.default.concat(l.default).concat([{name:"width",default:"20"},{name:"height",default:"20"}]),render:function(e){var t=e.node,n=u.splitMatrixAndProps(e.evaluateNodeConfig(t)),i=n.props,l=n.matrix;return[a.createElement("rect",r({x:-i.width/2,y:-i.height/2,transform:o.toSVG(l),key:e.getId()},i))]}}},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={},n=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=n.join("");return o in t?t[o]:t[o]=e.apply(void 0,a(n))};return n.memo=t,n}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(5),i=n(4),u=n(7),l=n(1),c=n(48),d=2*Math.PI,s=c.default(function(e,t,n,r,a){var o=[];t=parseFloat(t),n=parseFloat(n),r=parseFloat(r),a=parseFloat(a);for(var i=0;i<e;i++){var u=i%2==0?t:n,l=(i/e+(i%2==0?r:a))*d,c=Math.cos(l)*u,s=Math.sin(l)*u;isNaN(c)||isNaN(s)||o.push((0===i?"M":"L")+c.toFixed(3)+","+s.toFixed(3))}return o.length>0&&o.push("z"),o.join(" ")});t.default={variables:o.default.concat(u.default).concat([{name:"vertices",default:"5"},{name:"radius1",default:"5"},{name:"radius2",default:"5"},{name:"tilt1",default:"0"},{name:"tilt2",default:"0"}]),render:function(e){var t=e.node,n=i.splitMatrixAndProps(e.evaluateNodeConfig(t)),o=n.props,u=n.matrix,c=s(o.vertices,o.radius1,o.radius2,o.tilt1,o.tilt2);return delete o.vertices,delete o.radius1,delete o.radius2,delete o.tilt1,delete o.tilt2,[a.createElement("path",r({d:c},o,{key:e.getId(t.id),transform:l.toSVG(u)}))]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanPresentationProps=function(e){""===e.stroke&&delete e.stroke,""===e.fill&&delete e.fill}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(1),i=n(5),u=n(4),l=n(7),c=n(50);t.default={variables:i.default.concat(l.default).concat([{name:"radiusX",default:"20"},{name:"radiusY",default:"20"}]),render:function(e){var t=u.splitMatrixAndProps(e.evaluateNodeConfig()),n=t.props,i=t.matrix,l=n.radiusX,d=""!==n.radiusY?n.radiusY:l;return delete n.radiusX,delete n.radiusY,c.cleanPresentationProps(n),[a.createElement("ellipse",r({cx:0,cy:0,rx:l,ry:d,transform:o.toSVG(i),key:e.getId()},n))]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=n(5),o=n(1),i=n(4);t.default={acceptsChildren:!0,variables:a.default.concat([{name:"opacity",default:"1"}]),render:function(e){var t=e.renderChildren(),n=i.splitMatrixAndProps(e.evaluateNodeConfig()),a=n.props,u=n.matrix,l=a.opacity;return[r.createElement("g",{transform:o.toSVG(u),opacity:l},t)]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);t.default={acceptsChildren:!0,variables:[{name:"keep",default:"=rand() < .5"},{name:"indexVariable",default:"i"}],render:function(e){var t=e.node,n=e.evaluateFromNodeConfig("indexVariable"),a=[];r.renderNodesInto(a,t.children,e);var o=e.subcontext(t),i=t.config.keep;return a.filter(function(e,t){var r;return o.evaluate("keep "+t,i,((r={})[n]=t,r))})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);t.default={acceptsChildren:!0,variables:[{name:"childIndex",default:"0"},{name:"indexVariable",default:"u"}],render:function(e){var t,n=e.node,a=e.evaluateNodeConfig(n),o=a.childIndex,i=a.indexVariable,u=parseInt(o,10),l=n.children[u%n.children.length],c=[];if(l){var d=e.subcontext(n,((t={})[i]=o,t),"child"+o);r.renderNodesInto(c,[l],d)}return c}}},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),o=1.5,i=Math.sqrt(3),u=i/2;function l(e,t,n){return"flat"===e||"flatRect"===e?("flatRect"===e&&(n-=t>>1),[o*t,u*t+i*n]):"pointy"===e||"pointyRect"===e?("pointyRect"===e&&(t-=n>>1),[i*t+u*n,o*n]):[0,0]}t.default={acceptsChildren:!0,variables:[{name:"numberX",default:"5"},{name:"numberY",default:"5"},{name:"variableX",default:"vx"},{name:"variableY",default:"vy"},{name:"hex",default:"none",choices:["none","flat","flatRect","pointy","pointyRect"]}],render:function(e){var t,n=e.node,o=e.evaluateNodeConfig(n),i=o.numberX,u=o.numberY,c=o.variableX,d=o.variableY,s=o.hex,f=[];i=Math.round(parseFloat(i)),u=Math.round(parseFloat(u));for(var p=0;p<u;p++)for(var v=0;v<i;v++){var h=((t={})[c]=v,t[d]=p,t[c+"F"]=v/(i-1),t[d+"F"]=p/(u-1),t);if("none"!==s){var m=r(l(s,v,p),2),g=m[0],y=m[1];h[c+"Hex"]=g,h[d+"Hex"]=y}var b=e.subcontext(n,h,v+"x"+p);a.renderNodesInto(f,n.children,b)}return f}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);t.default={acceptsChildren:!0,variables:[{name:"number",default:"5"},{name:"variable",default:"i"}],render:function(e){for(var t,n=e.evaluateNodeConfig(),a=n.number,o=n.variable,i=[],u=Math.round(parseFloat(a)),l=e.node,c=0;c<u;c++){var d=e.subcontext(l,((t={})[o]=c,t[o+"F"]=c/(u-1),t),""+c);r.renderNodesInto(i,l.children,d)}return i}}},,,,,function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),a=n(17),o=function(){function t(){this.tree=[],this.nodeCache={},this.treeUpdateListeners=[]}return t.prototype.replaceTree=function(e){this.tree=r.cloneDeep(e),this.updateNodeCache(),this.invokeTreeUpdateListeners()},t.prototype.updateNodeCache=function(){var e={};this.tree.forEach(function(t){return function t(n,r){e[n.id]={node:n,parent:r},n.children.forEach(function(e){return t(e,n)})}(t,null)}),this.nodeCache=e},t.prototype.invokeTreeUpdateListeners=function(){var t=this;e(function(){t.treeUpdateListeners.forEach(function(e){e(t.tree)})})},t.prototype.getNodeOrNull=function(e){var t=this.getNodeCacheEntry(e,!1);return t?t.node:null},t.prototype.getNodeParentOrNull=function(e){var t=this.getNodeCacheEntry(e,!1);return t?t.parent:null},t.prototype.getNode=function(e){return this.getNodeCacheEntry(e).node},t.prototype.getNodeParent=function(e){return this.getNodeCacheEntry(e).parent},t.prototype.getNodeCacheEntry=function(e,t){void 0===t&&(t=!0);var n=this.nodeCache[e];if(t&&!n)throw new Error("invalid node "+e);return n||null},t.prototype.replaceOrEmsiblingNode=function(e,t,n,r){var a=null===e?this.tree:e.children,o=a.indexOf(t);if(o>-1){var i=[o,r?1:0].concat(n);a.splice.apply(a,i)}},t.prototype.getTree=function(){return this.tree},t.prototype.addTreeUpdateListener=function(e){this.treeUpdateListeners.push(e)},t.prototype.changeNodeVariable=function(e,t,n){this.getNode(e).config[t]=n,this.invokeTreeUpdateListeners()},t.prototype.addChildNode=function(e,t){var n=a.configure(t,{});return this.addChildInternal(e,n),this.updateNodeCache(),this.invokeTreeUpdateListeners(),n},t.prototype.addChildInternal=function(e,t){if(e){var n=this.getNode(e);return n.children.push(t),n}return this.tree.push(t),null},t.prototype.wrapNode=function(e,t){var n=this.getNode(e),r=this.getNodeParent(e),o=a.configure(t,{},[n]);return this.replaceOrEmsiblingNode(r,n,[o],!0),this.updateNodeCache(),this.invokeTreeUpdateListeners(),o},t.prototype.deleteNode=function(e,t){var n=this.getNode(e),r=this.getNodeParent(e);this.replaceOrEmsiblingNode(r,n,t?[]:n.children,!0),this.updateNodeCache(),this.invokeTreeUpdateListeners()},t.prototype.addSiblingNode=function(e,t){var n=a.configure(t,{}),r=this.getNode(e),o=this.getNodeParent(e);this.replaceOrEmsiblingNode(o,r,[n],!1),this.updateNodeCache(),this.invokeTreeUpdateListeners()},t.prototype.moveNode=function(e,t){if(e===t)return!1;var n=this.getNode(e),r=this.getNodeParent(e);return this.replaceOrEmsiblingNode(r,n,[],!0),this.addChildInternal(t,n),this.updateNodeCache(),this.invokeTreeUpdateListeners(),!0},t.prototype.copyNode=function(e,t){var n=a.duplicate(this.getNode(e));return this.addChildInternal(t,n),this.updateNodeCache(),this.invokeTreeUpdateListeners(),!0},t}();t.TreeManager=o}).call(this,n(60).setImmediate)},,,,function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0);t.default=function(e){var t=e.path,n=e.props;return a.createElement("svg",r({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},n),a.createElement("path",{d:t}))}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(18),o=n(0),i=n(65),u={fileTree:n(64),save:n(63),tune:n(62)},l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this,t=[{id:"tree",icon:u.fileTree},{id:"file",icon:u.save},{id:"gvars",icon:u.tune}];return o.createElement("div",{id:"global-toolbar",className:"toolbar"},t.map(function(t){return o.createElement("div",{key:t.id,className:a("btn",{active:e.props.activeTab===t.id}),title:t.id,onClick:function(){return e.props.onChangeTab(t.id)}},o.createElement(i.default,{path:t.icon}))}))},t}(o.Component);t.default=l},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(66),i=n(61),u=n(46),l=n(40),c=n(29),d=n(26),s=n(25),f=n(24),p=n(15),v=n(23),h=n(22),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.treeManager=new i.TreeManager,t.state={selectedNodeId:null,rendered:null,status:new d.default,activeTab:"tree",document:{nodes:[],width:800,height:800,background:"",gvars:[]}},t.loadDocument=function(e){var n=e.nodes;e.nodes=[],t.setState({document:e}),t.treeManager.replaceTree(n)},t.onSelectNode=function(e){t.setState({selectedNodeId:e?e.id:null})},t.onChangeTab=function(e){t.setState({activeTab:e})},t.onChangeDocumentVariable=function(e,n){var r=t.state.document;switch(e){case"width":case"height":r[e]=parseInt(n,10);break;default:r[e]=n}t.setState({document:r},function(){t.redrawCurrent()})},t.onAddGvar=function(){var e=t.state.document;e.gvars.push({name:function(){for(var t=function(t){var n=""+String.fromCharCode(97+e.gvars.length);return e.gvars.some(function(e){return e.name===n})?"continue":{value:n}},n=0;;n++){var r=t();if("object"==typeof r)return r.value}}(),type:"number",min:0,max:1,value:0}),t.setState({document:e})},t.onModifyGvar=function(e,n,r){var a=t.state.document;a.gvars.includes(e)&&(e[n]=r,t.setState({document:a},function(){"value"===n&&t.redrawCurrent()}))},t.onChangeGvarValue=function(e,n){var r=t.state.document;if(r.gvars.includes(e)){if("number"===e.type){var a=parseFloat(n);if(isNaN(a))return;e.value=a}t.setState({document:r},function(){t.redrawCurrent()})}},t.onDeleteGvar=function(e){var n=t.state.document;h.removeInPlace(n.gvars,e)&&t.setState({document:n},function(){t.redrawCurrent()})},t}return r(t,e),t.prototype.componentDidMount=function(){var e=this;this.treeManager.addTreeUpdateListener(function(t){e.renderDrawing(t)}),this.treeManager.addTreeUpdateListener(function(t){e.saveToStorage(t)}),this.loadFromStorage()},t.prototype.saveToStorage=function(e){f.save("coilSave",p.serialize(this.state.document,e||this.treeManager.getTree()))},t.prototype.loadFromStorage=function(){var e=f.load("coilSave");if(e)try{var t=p.deserialize(e);this.loadDocument(t)}catch(e){alert("Loading document from storage failed: "+e)}else this.treeManager.replaceTree(s.default())},t.prototype.renderDrawing=function(e){var t,n=new d.default,r={id:"root",module:"root",config:{},children:e},o=new c.default(n,r),i=this.state.document,u=i.width,l=i.height,s=i.background;i.gvars.forEach(function(e){o.variables[e.name]=e.value});try{t=o.renderChildren()}catch(e){t=a.createElement("text",{y:50,x:50},e.toString()),console.error(t)}var f=a.createElement("svg",{width:u,height:l,viewBox:"0 0 "+u+" "+l},s?a.createElement("rect",{x:0,y:0,width:u,height:l,fill:s,id:"background"}):null,t);this.setState({rendered:f,status:n})},t.prototype.redrawCurrent=function(e){void 0===e&&(e=!0);var t=this.treeManager.getTree();this.renderDrawing(t),e&&this.saveToStorage(t)},t.prototype.render=function(){var e=this.state,t=e.selectedNodeId,n=e.rendered,r=(e.status,e.activeTab),i=e.document,c=(this.treeManager.getNodeOrNull(t),null);switch(r){case"tree":c=a.createElement(l.default,{document:i,treeManager:this.treeManager,status:this.state.status,selectedNodeId:this.state.selectedNodeId,onSelectNode:this.onSelectNode,onChangeDocumentVariable:this.onChangeDocumentVariable,onChangeGvarValue:this.onChangeGvarValue});break;case"file":c=a.createElement(u.default,{treeManager:this.treeManager,rendered:n,document:i,onLoadDocument:this.loadDocument});break;case"gvars":c=a.createElement(v.default,{document:i,onAddGvar:this.onAddGvar,onModifyGvar:this.onModifyGvar,onDeleteGvar:this.onDeleteGvar})}return a.createElement(a.Fragment,null,a.createElement("div",{id:"config"},a.createElement(o.default,{activeTab:r,onChangeTab:this.onChangeTab}),c),a.createElement("div",{id:"drawing"},n))},t}(a.Component);t.default=m},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=n(19),o=n(67);n(21);var i=document.createElement("div");i.id="wrapper",document.body.appendChild(i),a.render(r.createElement(o.default,null),i)},function(e,t,n){e.exports=n(76)}]);
//# sourceMappingURL=main.26479b08.js.map